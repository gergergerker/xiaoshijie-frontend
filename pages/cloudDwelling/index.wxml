<!-- cloudDwellingé¡µé¢ - ç”¨æˆ·ä¸»é¡µ -->
<view class="cloud-dwelling-container">
  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="user-profile-section">
    <view class="user-info">
      <view class="avatar-container">
        <block wx:if="{{avatarUrl}}">
          <image class="user-avatar-image" src="{{avatarUrl}}" mode="aspectFill"></image>
        </block>
        <view class="user-avatar" wx:else>æ—¶</view>
      </view>
      <view class="user-details">
        <view class="username-container">
          <!-- æ ¹æ®ç™»å½•çŠ¶æ€æ˜¾ç¤ºä¸åŒå†…å®¹ -->
          <block wx:if="{{isLoggedIn}}">
            <view class="username">{{username}}</view>
            <!-- ç™»å½•çŠ¶æ€ä¸‹æ ‘æœ¨å±•ç¤ºåœ¨ç”¨æˆ·åå³ä¾§ -->
            <view class="tree-count-container login-state">
              <text class="tree-count-total">ğŸŒ³ {{treeCount}}æ£µ</text>
            </view>
          </block>
          <block wx:else>
            <view class="username not-logged">æœªç™»å½•</view>
            <!-- å¾®ä¿¡æ‰‹æœºå·æˆæƒæŒ‰é’® -->
            <button class="login-button-inline" open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">
              ä¸€é”®ç™»å½•
            </button>
            <!-- æœªç™»å½•çŠ¶æ€ä¸‹æ ‘æœ¨å±•ç¤ºåœ¨ç™»å½•æŒ‰é’®å³ä¾§ -->
            <view class="tree-count-container">
              <text class="tree-count-total">ğŸŒ³ {{treeCount}}æ£µ</text>
            </view>
          </block>
        </view>
        <view class="tree-details-row">
          <text class="tree-source">ç«ç­”:{{lantingTrees}}</text>
          <text class="tree-source">æ¼«æ¸¸:{{timeSequenceTrees}}</text>
          <text class="tree-source">å·²ç”¨:{{consumedTrees}}</text>
        </view>
      </view>
    </view>
    
    <!-- ç”¨æˆ·æ“ä½œæŒ‰é’® -->
    <view class="user-actions">
      <!-- è®¾ç½®æŒ‰é’® -->
      <view class="settings-button" bindtap="openSettings">
        <text>è®¾ç½®æ™“æ—¶ä¿¡æ¯</text>
      </view>
      
      <!-- ä¼šå‘˜æŒ‰é’® -->
      <view class="membership-button" bindtap="upgradeMembership">
        <text>å¼€é€šæ™“æ—¶ä¼šå‘˜</text>
      </view>
    </view>
  </view>

  <!-- æ—¶èŠ‚å±•ç¤ºåŒºåŸŸ -->
  <view class="season-display-section">
    <view class="section-title">
      <text>å½“å‰æ—¶èŠ‚</text>
    </view>
    
    <view class="current-season">
      <view class="season-image-container">
        <image class="season-image" src="{{currentSeason.imageUrl || '../../images/season-current.jpg'}}" mode="aspectFill"></image>
      </view>
      <view class="season-info">
        <view class="season-header">
          <view class="season-name-date">
            <text class="season-name">{{currentSeason.name}}</text>
            <text class="season-date">{{currentSeason.date}}</text>
          </view>
          <view class="season-countdown" wx:if="{{!isExactlyOnSolarTerm}}">
            <text>è·ç¦»{{nextSeasonName}}è¿˜æœ‰{{daysToNextSeason}}å¤©</text>
          </view>
        </view>
        <view class="season-description">{{currentSeason.description}}</view>
      </view>
    </view>
    
    <view class="season-quote">
      <text>"{{currentSeason.quote}}"</text>
    </view>
  </view>

  <!-- æ—¶èŠ‚æ¢ç´¢åŒºåŸŸ -->
  <view class="exploration-section">
    <view class="section-title">
      <text>æ—¶èŠ‚æ¢ç´¢</text>
    </view>
    
    <view class="exploration-cards">
      <!-- æ—¶åŸåšè§ˆ (å…³è” greenCliff é¡µé¢) -->
      <view class="exploration-card" bindtap="navigateTo" data-page="greenCliff">
        <view class="card-icon">ğŸï¸</view>
        <view class="card-content">
          <view class="card-title">æ—¶åŸåšè§ˆ</view>
          <view class="card-description">åšè§ˆæ—¶åŸå²æœˆè¿¹ï¼Œæ¢å¯»èŠ‚ä»¤å¾€æ¥è¸ª</view>
        </view>
      </view>
      
      <!-- æ—¶åŸæ¼«æ¸¸ (å…³è” timeSequence é¡µé¢) -->
      <view class="exploration-card" bindtap="navigateTo" data-page="timeSequence">
        <view class="card-icon">ğŸƒ</view>
        <view class="card-content">
          <view class="card-title">æ—¶åŸæ¼«æ¸¸</view>
          <view class="card-description">æ¯æ—¥ä¸€åŸå¯»æ•…äº‹ï¼Œåº”æ—¶åº”æ™¯æ¸¸å››æ–¹</view>
        </view>
      </view>
      
      <!-- æ—¶åŸç«ç­” (å…³è” lanTing é¡µé¢) -->
      <view class="exploration-card" bindtap="navigateTo" data-page="lanTing">
        <view class="card-icon">ğŸ“œ</view>
        <view class="card-content">
          <view class="card-title">æ—¶åŸç«ç­”</view>
          <view class="card-description">æ¼«æ­¥æ¥¼å°çƒŸé›¨ä¸­ï¼Œç»†å“å¥½é›¨çŸ¥æ—¶èŠ‚</view>
        </view>
      </view>
    </view>
  </view>

  <!-- è¶³è¿¹åˆ—è¡¨åŒºåŸŸ -->
  <view class="footprints-section">
    <view class="section-title">
      <text>æˆ‘çš„è¶³è¿¹</text>
    </view>
    
    <view class="footprints-container">
      <block wx:if="{{footprints && footprints.length > 0}}">
        <scroll-view scroll-x class="footprints-scroll">
          <view class="footprints-list">
            <view class="footprint-card" wx:for="{{footprints}}" wx:key="timestamp" bindtap="viewFootprintCity" data-city="{{item}}">
              <view class="footprint-icon">ğŸ‘£</view>
              <view class="footprint-info">
                <view class="footprint-city">{{item.cityName}}</view>
                <view class="footprint-date">{{item.date}}</view>
              </view>
            </view>
          </view>
        </scroll-view>
        <view class="footprints-more" bindtap="viewAllFootprints">æŸ¥çœ‹å…¨éƒ¨</view>
      </block>
      <view class="empty-footprints" wx:else>
        <view class="empty-icon">ğŸ—ºï¸</view>
        <view class="empty-text">æ‚¨è¿˜æ²¡æœ‰ç•™ä¸‹è¶³è¿¹</view>
        <view class="empty-action" bindtap="navigateTo" data-page="timeSequence">å»åŸå¸‚æ¼«æ¸¸</view>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·æ´»åŠ¨åŒºåŸŸ -->
  <view class="activity-section">
    <view class="section-title">
      <text>è¿‘æœŸæ´»åŠ¨</text>
    </view>
    
    <view class="activity-list">
      <view class="activity-item" wx:for="{{activities}}" wx:key="id">
        <view class="activity-time">{{item.time}}</view>
        <view class="activity-content">
          <text class="activity-text">{{item.text}}</text>
          <view class="activity-reward" wx:if="{{item.reward}}">
            <text>+ {{item.reward}} ğŸŒ³</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç³»ç»Ÿè®¾ç½®åŒºåŸŸ -->
  <view class="settings-section">
    <view class="section-title">
      <text>ç³»ç»Ÿè®¾ç½®</text>
    </view>
    
    <view class="settings-list">
      <view class="settings-item" bindtap="navigateToSystemPage" data-page="about">
        <view class="settings-icon">ğŸ“–</view>
        <view class="settings-content">
          <text class="settings-text">å…³äºæˆ‘ä»¬</text>
        </view>
        <view class="settings-arrow">></view>
      </view>
      
      <view class="settings-item" bindtap="navigateToSystemPage" data-page="userAgreement">
        <view class="settings-icon">ğŸ“</view>
        <view class="settings-content">
          <text class="settings-text">ç”¨æˆ·åè®®</text>
        </view>
        <view class="settings-arrow">></view>
      </view>
      
      <view class="settings-item" bindtap="navigateToSystemPage" data-page="privacyPolicy">
        <view class="settings-icon">ğŸ”’</view>
        <view class="settings-content">
          <text class="settings-text">éšç§æ”¿ç­–</text>
        </view>
        <view class="settings-arrow">></view>
      </view>
      
      <view class="settings-item" bindtap="navigateToSystemPage" data-page="contactUs">
        <view class="settings-icon">ğŸ“</view>
        <view class="settings-content">
          <text class="settings-text">è”ç³»å®¢æœ</text>
        </view>
        <view class="settings-arrow">></view>
      </view>
      
      <view class="settings-item" bindtap="clearCache">
        <view class="settings-icon">ğŸ§¹</view>
        <view class="settings-content">
          <text class="settings-text">æ¸…é™¤ç¼“å­˜</text>
        </view>
        <view class="settings-arrow">></view>
      </view>
    </view>
    
    <view class="app-version">
      <text>æ™“æ—¶èŠ‚ v1.0.0</text>
    </view>
  </view>

  <!-- å…³äºæˆ‘ä»¬å¼¹çª— -->
  <view class="about-dialog-mask" wx:if="{{showAboutDialog}}" bindtap="closeAboutDialog">
    <view class="about-dialog" catchtap="catchDialogTap">
      <view class="about-dialog-header">
        <view class="about-dialog-title">å…³äºæˆ‘ä»¬</view>
        <view class="about-dialog-close" bindtap="closeAboutDialog">Ã—</view>
      </view>
      <view class="about-dialog-content">
        <view class="about-app-name">{{aboutInfo.name}} <text class="about-app-version">{{aboutInfo.version}}</text></view>
        <view class="about-app-desc">{{aboutInfo.description}}</view>
        <view class="about-app-contact" bindtap="copyEmail">
          <text class="contact-label">è”ç³»é‚®ç®±: </text>
          <text class="contact-value">{{aboutInfo.email}}</text>
        </view>
        <view class="about-app-copyright">{{aboutInfo.copyright}}</view>
      </view>
    </view>
  </view>
</view>