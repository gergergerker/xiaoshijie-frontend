<!-- lanTingé¡µé¢ - çŸ¥è¯†PKå¤§èµ› -->
<view class="lanting-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="title-section">
    <view class="title-row">
      <view class="main-title">ä¸€é˜Ÿä¸€æ™¯Â·æ—¶åŸäº‰é”‹</view>
    </view>
    
    <!-- é˜µè¥é€‰æ‹©åŒºåŸŸ -->
    <view class="faction-selection" wx:if="{{!userFaction}}">
      <view class="selection-title">é€‰æ‹©ä½ çš„é˜µè¥</view>
      <view class="selection-subtitle">ï¼ˆåªæœ‰ä¸€æ¬¡é€‰æ‹©æœºä¼šï¼‰</view>
      <view class="faction-options">
        <view class="faction-option-simple tower" bindtap="selectFaction" data-faction="tower">
          <text>ğŸ¯ æ¥¼å°çƒŸé›¨ä¸­</text>
        </view>
        <view class="faction-option-simple rain" bindtap="selectFaction" data-faction="rain">
          <text>ğŸŒ§ï¸ å¥½é›¨çŸ¥æ—¶èŠ‚</text>
        </view>
      </view>
    </view>
    
    <!-- å·²é€‰æ‹©é˜µè¥æç¤º -->
    <view class="faction-selected" wx:if="{{userFaction}}">
      <view class="selected-title">ä½ çš„é˜µè¥</view>
      <view class="selected-faction">{{userFaction === 'tower' ? 'ğŸ¯ æ¥¼å°çƒŸé›¨ä¸­' : 'ğŸŒ§ï¸ å¥½é›¨çŸ¥æ—¶èŠ‚'}}</view>
    </view>
    
    <!-- æ“‚å°é€šçŸ¥æ ·å¼ -->
    <view class="battle-notice">
      <view class="notice-header">
        <view class="notice-title">æ“‚å°é€šçŸ¥</view>
      </view>
      <view class="notice-content">
        <text class="notice-line">"ç©¿è¶Šæ¥¼å°ï¼Œæ„ŸçŸ¥æ—¶èŠ‚ï¼"</text>
        <text class="notice-schedule">ä¸œå…«åŒº 19:30 é˜µè¥çŸ¥è¯†PKå¤§èµ›ï¼Œç­‰ä½ æ¥æˆ˜</text>
        <view class="pk-entrance-row">
          <view class="pk-entrance" bindtap="navigateToPK">é˜µè¥PKå…¥å£</view>
          <view class="pk-countdown">{{pkCountdownText}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- é˜µè¥å±•ç¤ºåŒºåŸŸ -->
  <view class="factions-row">
    <view class="faction-card tower-faction">
      <image class="faction-image" src="pics/æ¥¼å°çƒŸé›¨ä¸­.jpg" mode="aspectFill"></image>
      <view class="faction-overlay"></view>
      <view class="faction-info">
        <view class="faction-name">æ¥¼å°çƒŸé›¨ä¸­</view>
        <view class="faction-members">{{towerMemberCount}}äºº</view>
      </view>
    </view>
    
    <view class="faction-card rain-faction">
      <image class="faction-image" src="pics/å¥½é›¨çŸ¥æ—¶èŠ‚.jpg" mode="aspectFill"></image>
      <view class="faction-overlay"></view>
      <view class="faction-info">
        <view class="faction-name">å¥½é›¨çŸ¥æ—¶èŠ‚</view>
        <view class="faction-members">{{rainMemberCount}}äºº</view>
      </view>
    </view>
  </view>

  <!-- è®­ç»ƒæŒ‰é’® -->
  <view class="join-buttons">
    <view class="join-button tower-button" bindtap="startTraining" data-faction="tower">
      åŸå¸‚è®­ç»ƒ
    </view>
    <view class="join-button rain-button" bindtap="startTraining" data-faction="rain">
      æ—¶èŠ‚è®­ç»ƒ
    </view>
  </view>

  <!-- æ’è¡Œæ¦œ - ä»…åœ¨éè®­ç»ƒçŠ¶æ€æ˜¾ç¤º -->
  <view class="leaderboard-section" wx:if="{{currentState === 'home'}}">
    <view class="leaderboard-header">
      <view class="leaderboard-title">æ’è¡Œæ¦œ</view>
      <!-- å°æ ‘æ”¶è·å±•ç¤º -->
      <view class="tree-counter">
        <text class="tree-icon">ğŸŒ³</text>
        <text class="tree-count">{{lantingTrees}}é¢—</text>
        <text class="my-label">æˆ‘çš„</text>
      </view>
    </view>
    
    <!-- è·èƒœé˜µè¥ -->
    <view class="daily-winner" wx:if="{{dailyWinner}}">
      <view class="winner-header">æ˜¨æ—¥è·èƒœé˜µè¥</view>
      <view class="winner-content">
        <view class="winner-faction">{{dailyWinner.faction === 'tower' ? 'æ¥¼å°çƒŸé›¨ä¸­' : 'å¥½é›¨çŸ¥æ—¶èŠ‚'}}</view>
        <view class="winner-reward">å¥–åŠ±ï¼š2é¢—ğŸŒ³/äºº</view>
      </view>
    </view>
    
    <!-- ä¸ªäººå¥–åŠ±å‰ä¸‰å -->
    <view class="top-winners">
      <view class="winner-header">ä¸ªäººå¥–åŠ±å‰ä¸‰å</view>
      <view class="winner-list">
        <view class="winner-item" wx:for="{{leaderboardUsers}}" wx:key="index" wx:if="{{index < 3}}">
          <view class="winner-rank">{{index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}}</view>
          <view class="winner-info">
            <view class="winner-name">{{item.name}}</view>
            <view class="winner-faction-tag">{{item.faction === 'tower' ? 'æ¥¼å°çƒŸé›¨ä¸­' : 'å¥½é›¨çŸ¥æ—¶èŠ‚'}}</view>
          </view>
          <view class="winner-trees">{{3 - index}}é¢—ğŸŒ³</view>
        </view>
      </view>
    </view>
  </view>

  <!-- è®­ç»ƒåŒºåŸŸ -->
  <view class="training-section" wx:if="{{currentState === 'training'}}">
    <view class="training-header">
      <view class="training-title">{{trainingFaction === 'tower' ? 'åŸå¸‚çŸ¥è¯†è®­ç»ƒ' : 'æ—¶èŠ‚çŸ¥è¯†è®­ç»ƒ'}}</view>
      <view class="training-subtitle">ä¸ºä¸œå…«åŒº 19:30 çš„é˜µè¥PKåšå‡†å¤‡</view>
      <view class="back-btn" bindtap="backToHome">è¿”å›</view>
    </view>
    
    <!-- é¢˜ç›®åŒºåŸŸ -->
    <view class="question-container">
      <view class="question-number">ç¬¬ {{currentQuestionIndex + 1}}/{{questions.length}} é¢˜</view>
      <view class="question-text">{{currentQuestion.text}}</view>
      
      <!-- é€‰é¡¹ -->
      <view class="options-container">
        <view class="option-item {{selectedOption === index ? 'selected' : ''}}" 
              wx:for="{{currentQuestion.options}}" 
              wx:key="index"
              bindtap="selectOption"
              data-option-index="{{index}}">
          <text class="option-letter">{{optionLetters[index]}}</text>
          <text class="option-text">{{item}}</text>
        </view>
      </view>
      
      <!-- æäº¤æŒ‰é’® -->
      <button class="submit-answer" bindtap="submitAnswer" disabled="{{selectedOption === null}}">
        æäº¤ç­”æ¡ˆ
      </button>
    </view>
    
    <!-- è®­ç»ƒè¿›åº¦ç»Ÿè®¡ -->
    <view class="training-stats">
      <view class="stat-item">
        <text class="stat-label">ç­”é¢˜æ•°:</text>
        <text class="stat-value">{{answeredQuestions}}/{{questions.length}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">æ­£ç¡®ç‡:</text>
        <text class="stat-value">{{correctRate}}%</text>
      </view>
    </view>
  </view>

  <!-- ç»“æœå±•ç¤ºå¼¹çª— -->
  <view class="result-modal" wx:if="{{showResult}}">
    <view class="result-content">
      <view class="result-title">{{resultData.title}}</view>
      <view class="result-message">{{resultData.message}}</view>
      
      <view class="final-scores" wx:if="{{resultData.scores.length > 0}}">
        <view class="final-score-item" wx:for="{{resultData.scores}}" wx:key="teamId">
          <text>{{item.name}}: {{item.score}}{{resultData.isTraining ? 'åˆ†' : 'äºº'}}</text>
        </view>
      </view>
      
      <view class="reward-info" wx:if="{{resultData.reward && !resultData.isTraining}}">
        <text>æ­å–œè·å¾— {{resultData.reward}} é¢—ğŸŒ³ï¼</text>
      </view>
      
      <view class="training-tips" wx:if="{{resultData.isTraining}}">
        <text>è®°å¾—ä¸œå…«åŒº 19:30 å‚åŠ é˜µè¥PKèµ¢å–ğŸŒ³å¥–åŠ±ï¼</text>
      </view>
      
      <button class="close-result" bindtap="closeResult">ç¡®å®š</button>
    </view>
  </view>
</view> 
